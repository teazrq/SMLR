<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Spline | Statistical Machine Learning with R</title>
  <meta name="description" content="A Textbook for Statistical Machine Learning Courses at UIUC" />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Spline | Statistical Machine Learning with R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="A Textbook for Statistical Machine Learning Courses at UIUC" />
  <meta name="github-repo" content="teazrq/SMLR" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Spline | Statistical Machine Learning with R" />
  
  <meta name="twitter:description" content="A Textbook for Statistical Machine Learning Courses at UIUC" />
  

<meta name="author" content="Ruoqing Zhu, PhD" />


<meta name="date" content="2025-10-23" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
<link rel="prev" href="lasso.html"/>
<link rel="next" href="logistic-regression.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.33/datatables.js"></script>
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="libs/nouislider-7.0.10/jquery.nouislider.min.css" rel="stylesheet" />
<script src="libs/nouislider-7.0.10/jquery.nouislider.min.js"></script>
<link href="libs/selectize-0.12.0/selectize.bootstrap3.css" rel="stylesheet" />
<script src="libs/selectize-0.12.0/selectize.min.js"></script>
<link href="libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet" />
<script src="libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.11.0/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>
<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Statistical Machine Learning with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#target-audience"><i class="fa fa-check"></i>Target Audience</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#whats-covered"><i class="fa fa-check"></i>What’s Covered?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#license"><i class="fa fa-check"></i>License</a></li>
</ul></li>
<li class="part"><span><b>I Basics Knowledge</b></span></li>
<li class="chapter" data-level="1" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html"><i class="fa fa-check"></i><b>1</b> R and RStudio</a>
<ul>
<li class="chapter" data-level="1.1" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#installing-r-and-rstudio"><i class="fa fa-check"></i><b>1.1</b> Installing R and RStudio</a></li>
<li class="chapter" data-level="1.2" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#r-basic"><i class="fa fa-check"></i><b>1.2</b> Resources and Guides</a></li>
<li class="chapter" data-level="1.3" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#basic-mathematical-operations"><i class="fa fa-check"></i><b>1.3</b> Basic Mathematical Operations</a></li>
<li class="chapter" data-level="1.4" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#data-objects"><i class="fa fa-check"></i><b>1.4</b> Data Objects</a></li>
<li class="chapter" data-level="1.5" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#readin-and-save-data"><i class="fa fa-check"></i><b>1.5</b> Readin and save data</a></li>
<li class="chapter" data-level="1.6" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#using-and-defining-functions"><i class="fa fa-check"></i><b>1.6</b> Using and defining functions</a></li>
<li class="chapter" data-level="1.7" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#distribution-and-random-numbers"><i class="fa fa-check"></i><b>1.7</b> Distribution and random numbers</a></li>
<li class="chapter" data-level="1.8" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#using-packages-and-other-resources"><i class="fa fa-check"></i><b>1.8</b> Using packages and other resources</a></li>
<li class="chapter" data-level="1.9" data-path="r-and-rstudio.html"><a href="r-and-rstudio.html#practice-questions"><i class="fa fa-check"></i><b>1.9</b> Practice questions</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>2</b> RMarkdown</a>
<ul>
<li class="chapter" data-level="2.1" data-path="rmarkdown.html"><a href="rmarkdown.html#basics-and-resources"><i class="fa fa-check"></i><b>2.1</b> Basics and Resources</a></li>
<li class="chapter" data-level="2.2" data-path="rmarkdown.html"><a href="rmarkdown.html#formatting-text"><i class="fa fa-check"></i><b>2.2</b> Formatting Text</a></li>
<li class="chapter" data-level="2.3" data-path="rmarkdown.html"><a href="rmarkdown.html#adding-r-code"><i class="fa fa-check"></i><b>2.3</b> Adding <code>R</code> Code</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="rmarkdown.html"><a href="rmarkdown.html#r-chunks"><i class="fa fa-check"></i><b>2.3.1</b> <code>R</code> Chunks</a></li>
<li class="chapter" data-level="2.3.2" data-path="rmarkdown.html"><a href="rmarkdown.html#inline-r"><i class="fa fa-check"></i><b>2.3.2</b> Inline <code>R</code></a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="rmarkdown.html"><a href="rmarkdown.html#importing-data"><i class="fa fa-check"></i><b>2.4</b> Importing Data</a></li>
<li class="chapter" data-level="2.5" data-path="rmarkdown.html"><a href="rmarkdown.html#working-directory"><i class="fa fa-check"></i><b>2.5</b> Working Directory</a></li>
<li class="chapter" data-level="2.6" data-path="rmarkdown.html"><a href="rmarkdown.html#plotting"><i class="fa fa-check"></i><b>2.6</b> Plotting</a></li>
<li class="chapter" data-level="2.7" data-path="rmarkdown.html"><a href="rmarkdown.html#chunk-options"><i class="fa fa-check"></i><b>2.7</b> Chunk Options</a></li>
<li class="chapter" data-level="2.8" data-path="rmarkdown.html"><a href="rmarkdown.html#adding-math-with-latex"><i class="fa fa-check"></i><b>2.8</b> Adding Math with LaTeX</a>
<ul>
<li class="chapter" data-level="2.8.1" data-path="rmarkdown.html"><a href="rmarkdown.html#displaystyle-latex"><i class="fa fa-check"></i><b>2.8.1</b> Displaystyle LaTeX</a></li>
<li class="chapter" data-level="2.8.2" data-path="rmarkdown.html"><a href="rmarkdown.html#inline-latex"><i class="fa fa-check"></i><b>2.8.2</b> Inline LaTex</a></li>
</ul></li>
<li class="chapter" data-level="2.9" data-path="rmarkdown.html"><a href="rmarkdown.html#output-options"><i class="fa fa-check"></i><b>2.9</b> Output Options</a></li>
<li class="chapter" data-level="2.10" data-path="rmarkdown.html"><a href="rmarkdown.html#try-it"><i class="fa fa-check"></i><b>2.10</b> Try It!</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="visual-studio-code.html"><a href="visual-studio-code.html"><i class="fa fa-check"></i><b>3</b> Visual Studio Code</a>
<ul>
<li class="chapter" data-level="3.1" data-path="visual-studio-code.html"><a href="visual-studio-code.html#basics-and-resources-1"><i class="fa fa-check"></i><b>3.1</b> Basics and Resources</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="linear-algebra-basics.html"><a href="linear-algebra-basics.html"><i class="fa fa-check"></i><b>4</b> Linear Algebra Basics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="linear-algebra-basics.html"><a href="linear-algebra-basics.html#definition"><i class="fa fa-check"></i><b>4.1</b> Definition</a></li>
<li class="chapter" data-level="4.2" data-path="linear-algebra-basics.html"><a href="linear-algebra-basics.html#linear-regression"><i class="fa fa-check"></i><b>4.2</b> Linear Regression</a></li>
<li class="chapter" data-level="4.3" data-path="linear-algebra-basics.html"><a href="linear-algebra-basics.html#matrix-inversion"><i class="fa fa-check"></i><b>4.3</b> Matrix Inversion</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="linear-algebra-basics.html"><a href="linear-algebra-basics.html#linearalgebra-SM"><i class="fa fa-check"></i><b>4.3.1</b> Rank-one Update</a></li>
<li class="chapter" data-level="4.3.2" data-path="linear-algebra-basics.html"><a href="linear-algebra-basics.html#rank-k-update"><i class="fa fa-check"></i><b>4.3.2</b> Rank-<span class="math inline">\(k\)</span> Update</a></li>
<li class="chapter" data-level="4.3.3" data-path="linear-algebra-basics.html"><a href="linear-algebra-basics.html#times-2-block-matrix-inversion"><i class="fa fa-check"></i><b>4.3.3</b> 2 <span class="math inline">\(\times\)</span> 2 Block Matrix Inversion</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="optimization-basics.html"><a href="optimization-basics.html"><i class="fa fa-check"></i><b>5</b> Optimization Basics</a>
<ul>
<li class="chapter" data-level="5.1" data-path="optimization-basics.html"><a href="optimization-basics.html#basic-concept"><i class="fa fa-check"></i><b>5.1</b> Basic Concept</a></li>
<li class="chapter" data-level="5.2" data-path="optimization-basics.html"><a href="optimization-basics.html#global_local"><i class="fa fa-check"></i><b>5.2</b> Global vs. Local Optima</a></li>
<li class="chapter" data-level="5.3" data-path="optimization-basics.html"><a href="optimization-basics.html#example-linear-regression-using-optim"><i class="fa fa-check"></i><b>5.3</b> Example: Linear Regression using <code>optim()</code></a></li>
<li class="chapter" data-level="5.4" data-path="optimization-basics.html"><a href="optimization-basics.html#first-and-second-order-properties"><i class="fa fa-check"></i><b>5.4</b> First and Second Order Properties</a></li>
<li class="chapter" data-level="5.5" data-path="optimization-basics.html"><a href="optimization-basics.html#algorithm"><i class="fa fa-check"></i><b>5.5</b> Algorithm</a></li>
<li class="chapter" data-level="5.6" data-path="optimization-basics.html"><a href="optimization-basics.html#second-order-methods"><i class="fa fa-check"></i><b>5.6</b> Second-order Methods</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="optimization-basics.html"><a href="optimization-basics.html#newtons-method"><i class="fa fa-check"></i><b>5.6.1</b> Newton’s Method</a></li>
<li class="chapter" data-level="5.6.2" data-path="optimization-basics.html"><a href="optimization-basics.html#quasi-newton-methods"><i class="fa fa-check"></i><b>5.6.2</b> Quasi-Newton Methods</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="optimization-basics.html"><a href="optimization-basics.html#first-order-methods"><i class="fa fa-check"></i><b>5.7</b> First-order Methods</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="optimization-basics.html"><a href="optimization-basics.html#gradient-descent"><i class="fa fa-check"></i><b>5.7.1</b> Gradient Descent</a></li>
<li class="chapter" data-level="5.7.2" data-path="optimization-basics.html"><a href="optimization-basics.html#gradient-descent-example-linear-regression"><i class="fa fa-check"></i><b>5.7.2</b> Gradient Descent Example: Linear Regression</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="optimization-basics.html"><a href="optimization-basics.html#coordinate"><i class="fa fa-check"></i><b>5.8</b> Coordinate Descent</a>
<ul>
<li class="chapter" data-level="5.8.1" data-path="optimization-basics.html"><a href="optimization-basics.html#coordinate-descent-example-linear-regression"><i class="fa fa-check"></i><b>5.8.1</b> Coordinate Descent Example: Linear Regression</a></li>
</ul></li>
<li class="chapter" data-level="5.9" data-path="optimization-basics.html"><a href="optimization-basics.html#stocastic-gradient-descent"><i class="fa fa-check"></i><b>5.9</b> Stocastic Gradient Descent</a>
<ul>
<li class="chapter" data-level="5.9.1" data-path="optimization-basics.html"><a href="optimization-basics.html#mini-batch-stocastic-gradient-descent"><i class="fa fa-check"></i><b>5.9.1</b> Mini-batch Stocastic Gradient Descent</a></li>
</ul></li>
<li class="chapter" data-level="5.10" data-path="optimization-basics.html"><a href="optimization-basics.html#lagrangian-multiplier-for-constrained-problems"><i class="fa fa-check"></i><b>5.10</b> Lagrangian Multiplier for Constrained Problems</a></li>
</ul></li>
<li class="part"><span><b>II Linear and Penalized Linear Models</b></span></li>
<li class="chapter" data-level="6" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html"><i class="fa fa-check"></i><b>6</b> Linear Regression and Model Selection</a>
<ul>
<li class="chapter" data-level="6.1" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#example-real-estate-data"><i class="fa fa-check"></i><b>6.1</b> Example: real estate data</a></li>
<li class="chapter" data-level="6.2" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#notation-and-basic-properties"><i class="fa fa-check"></i><b>6.2</b> Notation and Basic Properties</a></li>
<li class="chapter" data-level="6.3" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#using-the-lm-function"><i class="fa fa-check"></i><b>6.3</b> Using the <code>lm()</code> Function</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#adding-covariates"><i class="fa fa-check"></i><b>6.3.1</b> Adding Covariates</a></li>
<li class="chapter" data-level="6.3.2" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#categorical-variables"><i class="fa fa-check"></i><b>6.3.2</b> Categorical Variables</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#model-selection-criteria"><i class="fa fa-check"></i><b>6.4</b> Model Selection Criteria</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#using-marrows-c_p"><i class="fa fa-check"></i><b>6.4.1</b> Using Marrows’ <span class="math inline">\(C_p\)</span></a></li>
<li class="chapter" data-level="6.4.2" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#using-aic-and-bic"><i class="fa fa-check"></i><b>6.4.2</b> Using AIC and BIC</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#model-selection-algorithms"><i class="fa fa-check"></i><b>6.5</b> Model Selection Algorithms</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#best-subset-selection-with-leaps"><i class="fa fa-check"></i><b>6.5.1</b> Best Subset Selection with <code>leaps</code></a></li>
<li class="chapter" data-level="6.5.2" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#step-wise-regression-using-step"><i class="fa fa-check"></i><b>6.5.2</b> Step-wise regression using <code>step()</code></a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="linear-regression-and-model-selection.html"><a href="linear-regression-and-model-selection.html#marrows-cp"><i class="fa fa-check"></i><b>6.6</b> Derivation of Marrows’ <span class="math inline">\(C_p\)</span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="ridge-regression.html"><a href="ridge-regression.html"><i class="fa fa-check"></i><b>7</b> Ridge Regression</a>
<ul>
<li class="chapter" data-level="7.1" data-path="ridge-regression.html"><a href="ridge-regression.html#motivation-correlated-variables-and-convexity"><i class="fa fa-check"></i><b>7.1</b> Motivation: Correlated Variables and Convexity</a></li>
<li class="chapter" data-level="7.2" data-path="ridge-regression.html"><a href="ridge-regression.html#ridge-penalty-and-the-reduced-variation"><i class="fa fa-check"></i><b>7.2</b> Ridge Penalty and the Reduced Variation</a></li>
<li class="chapter" data-level="7.3" data-path="ridge-regression.html"><a href="ridge-regression.html#bias-and-variance-of-ridge-regression"><i class="fa fa-check"></i><b>7.3</b> Bias and Variance of Ridge Regression</a></li>
<li class="chapter" data-level="7.4" data-path="ridge-regression.html"><a href="ridge-regression.html#degrees-of-freedom"><i class="fa fa-check"></i><b>7.4</b> Degrees of Freedom</a></li>
<li class="chapter" data-level="7.5" data-path="ridge-regression.html"><a href="ridge-regression.html#using-the-lm.ridge-function"><i class="fa fa-check"></i><b>7.5</b> Using the <code>lm.ridge()</code> function</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="ridge-regression.html"><a href="ridge-regression.html#scaling-issue"><i class="fa fa-check"></i><b>7.5.1</b> Scaling Issue</a></li>
<li class="chapter" data-level="7.5.2" data-path="ridge-regression.html"><a href="ridge-regression.html#multiple-lambda-values"><i class="fa fa-check"></i><b>7.5.2</b> Multiple <span class="math inline">\(\lambda\)</span> values</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="ridge-regression.html"><a href="ridge-regression.html#cross-validation"><i class="fa fa-check"></i><b>7.6</b> Cross-validation</a></li>
<li class="chapter" data-level="7.7" data-path="ridge-regression.html"><a href="ridge-regression.html#leave-one-out-cross-validation"><i class="fa fa-check"></i><b>7.7</b> Leave-one-out cross-validation</a>
<ul>
<li class="chapter" data-level="7.7.1" data-path="ridge-regression.html"><a href="ridge-regression.html#generalized-cross-validation"><i class="fa fa-check"></i><b>7.7.1</b> Generalized cross-validation</a></li>
</ul></li>
<li class="chapter" data-level="7.8" data-path="ridge-regression.html"><a href="ridge-regression.html#the-glmnet-package"><i class="fa fa-check"></i><b>7.8</b> The <code>glmnet</code> package</a>
<ul>
<li class="chapter" data-level="7.8.1" data-path="ridge-regression.html"><a href="ridge-regression.html#scaling-issue-1"><i class="fa fa-check"></i><b>7.8.1</b> Scaling Issue</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="lasso.html"><a href="lasso.html"><i class="fa fa-check"></i><b>8</b> Lasso</a>
<ul>
<li class="chapter" data-level="8.1" data-path="lasso.html"><a href="lasso.html#one-variable-lasso-and-shrinkage"><i class="fa fa-check"></i><b>8.1</b> One-Variable Lasso and Shrinkage</a></li>
<li class="chapter" data-level="8.2" data-path="lasso.html"><a href="lasso.html#constrained-optimization-view"><i class="fa fa-check"></i><b>8.2</b> Constrained Optimization View</a></li>
<li class="chapter" data-level="8.3" data-path="lasso.html"><a href="lasso.html#the-solution-path"><i class="fa fa-check"></i><b>8.3</b> The Solution Path</a></li>
<li class="chapter" data-level="8.4" data-path="lasso.html"><a href="lasso.html#path-wise-coordinate-descent"><i class="fa fa-check"></i><b>8.4</b> Path-wise Coordinate Descent</a></li>
<li class="chapter" data-level="8.5" data-path="lasso.html"><a href="lasso.html#using-the-glmnet-package"><i class="fa fa-check"></i><b>8.5</b> Using the <code>glmnet</code> package</a></li>
<li class="chapter" data-level="8.6" data-path="lasso.html"><a href="lasso.html#elastic-net"><i class="fa fa-check"></i><b>8.6</b> Elastic-Net</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="spline.html"><a href="spline.html"><i class="fa fa-check"></i><b>9</b> Spline</a>
<ul>
<li class="chapter" data-level="9.1" data-path="spline.html"><a href="spline.html#using-linear-models-for-nonlinear-trends"><i class="fa fa-check"></i><b>9.1</b> Using Linear models for Nonlinear Trends</a></li>
<li class="chapter" data-level="9.2" data-path="spline.html"><a href="spline.html#a-motivating-example-and-polynomials"><i class="fa fa-check"></i><b>9.2</b> A Motivating Example and Polynomials</a></li>
<li class="chapter" data-level="9.3" data-path="spline.html"><a href="spline.html#piecewise-polynomials"><i class="fa fa-check"></i><b>9.3</b> Piecewise Polynomials</a></li>
<li class="chapter" data-level="9.4" data-path="spline.html"><a href="spline.html#splines"><i class="fa fa-check"></i><b>9.4</b> Splines</a></li>
<li class="chapter" data-level="9.5" data-path="spline.html"><a href="spline.html#spline-basis"><i class="fa fa-check"></i><b>9.5</b> Spline Basis</a></li>
<li class="chapter" data-level="9.6" data-path="spline.html"><a href="spline.html#natural-cubic-spline"><i class="fa fa-check"></i><b>9.6</b> Natural Cubic Spline</a></li>
<li class="chapter" data-level="9.7" data-path="spline.html"><a href="spline.html#smoothing-spline"><i class="fa fa-check"></i><b>9.7</b> Smoothing Spline</a></li>
<li class="chapter" data-level="9.8" data-path="spline.html"><a href="spline.html#fitting-smoothing-splines"><i class="fa fa-check"></i><b>9.8</b> Fitting Smoothing Splines</a></li>
<li class="chapter" data-level="9.9" data-path="spline.html"><a href="spline.html#extending-splines-to-multiple-varibles"><i class="fa fa-check"></i><b>9.9</b> Extending Splines to Multiple Varibles</a></li>
</ul></li>
<li class="part"><span><b>III Linear Classification Models</b></span></li>
<li class="chapter" data-level="10" data-path="logistic-regression.html"><a href="logistic-regression.html"><i class="fa fa-check"></i><b>10</b> Logistic Regression</a>
<ul>
<li class="chapter" data-level="10.1" data-path="logistic-regression.html"><a href="logistic-regression.html#modeling-binary-outcomes"><i class="fa fa-check"></i><b>10.1</b> Modeling Binary Outcomes</a></li>
<li class="chapter" data-level="10.2" data-path="logistic-regression.html"><a href="logistic-regression.html#example-cleveland-clinic-heart-disease-data"><i class="fa fa-check"></i><b>10.2</b> Example: Cleveland Clinic Heart Disease Data</a></li>
<li class="chapter" data-level="10.3" data-path="logistic-regression.html"><a href="logistic-regression.html#interpretation-of-the-parameters"><i class="fa fa-check"></i><b>10.3</b> Interpretation of the Parameters</a></li>
<li class="chapter" data-level="10.4" data-path="logistic-regression.html"><a href="logistic-regression.html#solving-a-logistic-regression"><i class="fa fa-check"></i><b>10.4</b> Solving a Logistic Regression</a></li>
<li class="chapter" data-level="10.5" data-path="logistic-regression.html"><a href="logistic-regression.html#example-south-africa-heart-data"><i class="fa fa-check"></i><b>10.5</b> Example: South Africa Heart Data</a></li>
<li class="chapter" data-level="10.6" data-path="logistic-regression.html"><a href="logistic-regression.html#penalized-logistic-regression"><i class="fa fa-check"></i><b>10.6</b> Penalized Logistic Regression</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html"><i class="fa fa-check"></i><b>11</b> Discriminant Analysis</a>
<ul>
<li class="chapter" data-level="11.1" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html#bayes-rule"><i class="fa fa-check"></i><b>11.1</b> Bayes Rule</a></li>
<li class="chapter" data-level="11.2" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html#example-linear-discriminant-analysis-lda"><i class="fa fa-check"></i><b>11.2</b> Example: Linear Discriminant Analysis (LDA)</a></li>
<li class="chapter" data-level="11.3" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html#linear-discriminant-analysis"><i class="fa fa-check"></i><b>11.3</b> Linear Discriminant Analysis</a></li>
<li class="chapter" data-level="11.4" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html#example-quadratic-discriminant-analysis-qda"><i class="fa fa-check"></i><b>11.4</b> Example: Quadratic Discriminant Analysis (QDA)</a></li>
<li class="chapter" data-level="11.5" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html#quadratic-discriminant-analysis"><i class="fa fa-check"></i><b>11.5</b> Quadratic Discriminant Analysis</a></li>
<li class="chapter" data-level="11.6" data-path="discriminant-analysis.html"><a href="discriminant-analysis.html#example-the-hand-written-digit-data"><i class="fa fa-check"></i><b>11.6</b> Example: the Hand Written Digit Data</a></li>
</ul></li>
<li class="part"><span><b>IV Nonparametric Models</b></span></li>
<li class="chapter" data-level="12" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html"><i class="fa fa-check"></i><b>12</b> K-Neariest Neighber</a>
<ul>
<li class="chapter" data-level="12.1" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html#definition-1"><i class="fa fa-check"></i><b>12.1</b> Definition</a></li>
<li class="chapter" data-level="12.2" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html#tuning-k"><i class="fa fa-check"></i><b>12.2</b> Tuning <span class="math inline">\(k\)</span></a></li>
<li class="chapter" data-level="12.3" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html#the-bias-variance-trade-off"><i class="fa fa-check"></i><b>12.3</b> The Bias-variance Trade-off</a></li>
<li class="chapter" data-level="12.4" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html#knn-for-classification"><i class="fa fa-check"></i><b>12.4</b> KNN for Classification</a></li>
<li class="chapter" data-level="12.5" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html#example-1-an-artificial-data"><i class="fa fa-check"></i><b>12.5</b> Example 1: An artificial data</a></li>
<li class="chapter" data-level="12.6" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html#degrees-of-freedom-1"><i class="fa fa-check"></i><b>12.6</b> Degrees of Freedom</a></li>
<li class="chapter" data-level="12.7" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html#tuning-with-the-caret-package"><i class="fa fa-check"></i><b>12.7</b> Tuning with the <code>caret</code> Package</a></li>
<li class="chapter" data-level="12.8" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html#distance-measures"><i class="fa fa-check"></i><b>12.8</b> Distance Measures</a></li>
<li class="chapter" data-level="12.9" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html#nn-error-bound"><i class="fa fa-check"></i><b>12.9</b> 1NN Error Bound</a></li>
<li class="chapter" data-level="12.10" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html#example-2-handwritten-digit-data"><i class="fa fa-check"></i><b>12.10</b> Example 2: Handwritten Digit Data</a></li>
<li class="chapter" data-level="12.11" data-path="k-neariest-neighber.html"><a href="k-neariest-neighber.html#curse-of-dimensionality"><i class="fa fa-check"></i><b>12.11</b> Curse of Dimensionality</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="kernel-smoothing.html"><a href="kernel-smoothing.html"><i class="fa fa-check"></i><b>13</b> Kernel Smoothing</a>
<ul>
<li class="chapter" data-level="13.1" data-path="kernel-smoothing.html"><a href="kernel-smoothing.html#knn-vs.-kernel"><i class="fa fa-check"></i><b>13.1</b> KNN vs. Kernel</a></li>
<li class="chapter" data-level="13.2" data-path="kernel-smoothing.html"><a href="kernel-smoothing.html#kernel-density-estimations"><i class="fa fa-check"></i><b>13.2</b> Kernel Density Estimations</a></li>
<li class="chapter" data-level="13.3" data-path="kernel-smoothing.html"><a href="kernel-smoothing.html#expectation-of-the-parzen-estimator"><i class="fa fa-check"></i><b>13.3</b> Expectation of the Parzen estimator</a></li>
<li class="chapter" data-level="13.4" data-path="kernel-smoothing.html"><a href="kernel-smoothing.html#gaussian-kernel-regression"><i class="fa fa-check"></i><b>13.4</b> Gaussian Kernel Regression</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="kernel-smoothing.html"><a href="kernel-smoothing.html#bias-variance-trade-off"><i class="fa fa-check"></i><b>13.4.1</b> Bias-variance Trade-off</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="kernel-smoothing.html"><a href="kernel-smoothing.html#choice-of-kernel-functions"><i class="fa fa-check"></i><b>13.5</b> Choice of Kernel Functions</a></li>
<li class="chapter" data-level="13.6" data-path="kernel-smoothing.html"><a href="kernel-smoothing.html#local-linear-regression"><i class="fa fa-check"></i><b>13.6</b> Local Linear Regression</a></li>
<li class="chapter" data-level="13.7" data-path="kernel-smoothing.html"><a href="kernel-smoothing.html#local-polynomial-regression"><i class="fa fa-check"></i><b>13.7</b> Local Polynomial Regression</a></li>
<li class="chapter" data-level="13.8" data-path="kernel-smoothing.html"><a href="kernel-smoothing.html#r-implementations"><i class="fa fa-check"></i><b>13.8</b> R Implementations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="nonpara.html"><a href="nonpara.html"><i class="fa fa-check"></i><b>14</b> Nonparemetric Estimation Rates</a>
<ul>
<li class="chapter" data-level="14.1" data-path="nonpara.html"><a href="nonpara.html#kernel-density-estimation"><i class="fa fa-check"></i><b>14.1</b> Kernel Density Estimation</a></li>
<li class="chapter" data-level="14.2" data-path="nonpara.html"><a href="nonpara.html#the-effect-of-smoothness"><i class="fa fa-check"></i><b>14.2</b> The Effect of Smoothness</a></li>
<li class="chapter" data-level="14.3" data-path="nonpara.html"><a href="nonpara.html#the-effect-of-dimensionality"><i class="fa fa-check"></i><b>14.3</b> The Effect of Dimensionality</a></li>
<li class="chapter" data-level="14.4" data-path="nonpara.html"><a href="nonpara.html#nadaraya-watson-regression-estimator"><i class="fa fa-check"></i><b>14.4</b> Nadaraya-Watson Regression Estimator</a></li>
</ul></li>
<li class="part"><span><b>V Kernel Machines</b></span></li>
<li class="chapter" data-level="15" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html"><i class="fa fa-check"></i><b>15</b> Reproducing Kernel Hilbert Space</a>
<ul>
<li class="chapter" data-level="15.1" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#the-motivation"><i class="fa fa-check"></i><b>15.1</b> The Motivation</a></li>
<li class="chapter" data-level="15.2" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#hilbert-space-preliminaries"><i class="fa fa-check"></i><b>15.2</b> Hilbert Space Preliminaries</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#the-space-of-square-integrable-functions"><i class="fa fa-check"></i><b>15.2.1</b> The Space of Square-Integrable Functions</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#a-kernel-function"><i class="fa fa-check"></i><b>15.3</b> A Kernel Function</a></li>
<li class="chapter" data-level="15.4" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#a-space-of-functions"><i class="fa fa-check"></i><b>15.4</b> A Space of Functions</a></li>
<li class="chapter" data-level="15.5" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#the-inner-product"><i class="fa fa-check"></i><b>15.5</b> The Inner Product</a></li>
<li class="chapter" data-level="15.6" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#the-rkhs"><i class="fa fa-check"></i><b>15.6</b> The RKHS</a></li>
<li class="chapter" data-level="15.7" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#the-reproducing-property"><i class="fa fa-check"></i><b>15.7</b> The Reproducing Property</a></li>
<li class="chapter" data-level="15.8" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#smoothness"><i class="fa fa-check"></i><b>15.8</b> Smoothness</a></li>
<li class="chapter" data-level="15.9" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#the-moorearonszajn-theorem"><i class="fa fa-check"></i><b>15.9</b> The Moore–Aronszajn Theorem</a></li>
<li class="chapter" data-level="15.10" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#examples"><i class="fa fa-check"></i><b>15.10</b> Examples</a>
<ul>
<li class="chapter" data-level="15.10.1" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#brownian-motion-kernel"><i class="fa fa-check"></i><b>15.10.1</b> Brownian Motion Kernel</a></li>
<li class="chapter" data-level="15.10.2" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#non-positive-definite-kernel"><i class="fa fa-check"></i><b>15.10.2</b> Non-positive Definite Kernel</a></li>
<li class="chapter" data-level="15.10.3" data-path="reproducing-kernel-hilbert-space.html"><a href="reproducing-kernel-hilbert-space.html#defining-new-kernels"><i class="fa fa-check"></i><b>15.10.3</b> Defining New Kernels</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="kernel-ridge-regression.html"><a href="kernel-ridge-regression.html"><i class="fa fa-check"></i><b>16</b> Kernel Ridge Regression</a>
<ul>
<li class="chapter" data-level="16.1" data-path="kernel-ridge-regression.html"><a href="kernel-ridge-regression.html#linear-regression-as-a-constraint-optimization"><i class="fa fa-check"></i><b>16.1</b> Linear Regression as a Constraint Optimization</a></li>
<li class="chapter" data-level="16.2" data-path="kernel-ridge-regression.html"><a href="kernel-ridge-regression.html#the-kernel-ridge-regression"><i class="fa fa-check"></i><b>16.2</b> The Kernel Ridge Regression</a></li>
<li class="chapter" data-level="16.3" data-path="kernel-ridge-regression.html"><a href="kernel-ridge-regression.html#ridge-regression-as-a-linear-kernel-model"><i class="fa fa-check"></i><b>16.3</b> Ridge Regression as a Linear Kernel Model</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="support-vector-machines.html"><a href="support-vector-machines.html"><i class="fa fa-check"></i><b>17</b> Support Vector Machines</a>
<ul>
<li class="chapter" data-level="17.1" data-path="support-vector-machines.html"><a href="support-vector-machines.html#maximum-margin-classifier"><i class="fa fa-check"></i><b>17.1</b> Maximum-margin Classifier</a></li>
<li class="chapter" data-level="17.2" data-path="support-vector-machines.html"><a href="support-vector-machines.html#linearly-separable-svm"><i class="fa fa-check"></i><b>17.2</b> Linearly Separable SVM</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="support-vector-machines.html"><a href="support-vector-machines.html#from-primal-to-dual"><i class="fa fa-check"></i><b>17.2.1</b> From Primal to Dual</a></li>
</ul></li>
<li class="chapter" data-level="17.3" data-path="support-vector-machines.html"><a href="support-vector-machines.html#linearly-non-separable-svm-with-slack-variables"><i class="fa fa-check"></i><b>17.3</b> Linearly Non-separable SVM with Slack Variables</a></li>
<li class="chapter" data-level="17.4" data-path="support-vector-machines.html"><a href="support-vector-machines.html#example-saheart-data"><i class="fa fa-check"></i><b>17.4</b> Example: <code>SAheart</code> Data</a></li>
<li class="chapter" data-level="17.5" data-path="support-vector-machines.html"><a href="support-vector-machines.html#nonlinear-svm-via-kernel-trick"><i class="fa fa-check"></i><b>17.5</b> Nonlinear SVM via Kernel Trick</a></li>
<li class="chapter" data-level="17.6" data-path="support-vector-machines.html"><a href="support-vector-machines.html#example-mixture.example-data"><i class="fa fa-check"></i><b>17.6</b> Example: <code>mixture.example</code> Data</a></li>
<li class="chapter" data-level="17.7" data-path="support-vector-machines.html"><a href="support-vector-machines.html#svm-as-a-penalized-model"><i class="fa fa-check"></i><b>17.7</b> SVM as a Penalized Model</a></li>
<li class="chapter" data-level="17.8" data-path="support-vector-machines.html"><a href="support-vector-machines.html#kernel-and-feature-maps-another-example"><i class="fa fa-check"></i><b>17.8</b> Kernel and Feature Maps: Another Example</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="the-representer-theorem.html"><a href="the-representer-theorem.html"><i class="fa fa-check"></i><b>18</b> The Representer Theorem</a>
<ul>
<li class="chapter" data-level="18.1" data-path="the-representer-theorem.html"><a href="the-representer-theorem.html#the-representer-theorem-1"><i class="fa fa-check"></i><b>18.1</b> The Representer Theorem</a></li>
<li class="chapter" data-level="18.2" data-path="the-representer-theorem.html"><a href="the-representer-theorem.html#notes-on-application"><i class="fa fa-check"></i><b>18.2</b> Notes on Application</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="support-vector-regression.html"><a href="support-vector-regression.html"><i class="fa fa-check"></i><b>19</b> Support Vector Regression</a>
<ul>
<li class="chapter" data-level="19.1" data-path="support-vector-regression.html"><a href="support-vector-regression.html#the-epsilon-insensitive-loss"><i class="fa fa-check"></i><b>19.1</b> The <span class="math inline">\(\epsilon\)</span>-insensitive Loss</a></li>
<li class="chapter" data-level="19.2" data-path="support-vector-regression.html"><a href="support-vector-regression.html#primal-and-dual-formulation-of-svr"><i class="fa fa-check"></i><b>19.2</b> Primal and Dual Formulation of SVR</a></li>
<li class="chapter" data-level="19.3" data-path="support-vector-regression.html"><a href="support-vector-regression.html#penalized-svr-with-rkhs"><i class="fa fa-check"></i><b>19.3</b> Penalized SVR with RKHS</a></li>
</ul></li>
<li class="part"><span><b>VI Trees and Ensembles</b></span></li>
<li class="chapter" data-level="20" data-path="classification-and-regression-trees.html"><a href="classification-and-regression-trees.html"><i class="fa fa-check"></i><b>20</b> Classification and Regression Trees</a>
<ul>
<li class="chapter" data-level="20.1" data-path="classification-and-regression-trees.html"><a href="classification-and-regression-trees.html#example-classification-tree"><i class="fa fa-check"></i><b>20.1</b> Example: Classification Tree</a></li>
<li class="chapter" data-level="20.2" data-path="classification-and-regression-trees.html"><a href="classification-and-regression-trees.html#splitting-a-node"><i class="fa fa-check"></i><b>20.2</b> Splitting a Node</a></li>
<li class="chapter" data-level="20.3" data-path="classification-and-regression-trees.html"><a href="classification-and-regression-trees.html#regression-trees"><i class="fa fa-check"></i><b>20.3</b> Regression Trees</a></li>
<li class="chapter" data-level="20.4" data-path="classification-and-regression-trees.html"><a href="classification-and-regression-trees.html#predicting-a-target-point"><i class="fa fa-check"></i><b>20.4</b> Predicting a Target Point</a></li>
<li class="chapter" data-level="20.5" data-path="classification-and-regression-trees.html"><a href="classification-and-regression-trees.html#tuning-a-tree-model"><i class="fa fa-check"></i><b>20.5</b> Tuning a Tree Model</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="random-forests.html"><a href="random-forests.html"><i class="fa fa-check"></i><b>21</b> Random Forests</a>
<ul>
<li class="chapter" data-level="21.1" data-path="random-forests.html"><a href="random-forests.html#bagging-predictors"><i class="fa fa-check"></i><b>21.1</b> Bagging Predictors</a></li>
<li class="chapter" data-level="21.2" data-path="random-forests.html"><a href="random-forests.html#random-forests-1"><i class="fa fa-check"></i><b>21.2</b> Random Forests</a></li>
<li class="chapter" data-level="21.3" data-path="random-forests.html"><a href="random-forests.html#kernel-view-of-random-forests"><i class="fa fa-check"></i><b>21.3</b> Kernel view of Random Forests</a></li>
<li class="chapter" data-level="21.4" data-path="random-forests.html"><a href="random-forests.html#variable-importance"><i class="fa fa-check"></i><b>21.4</b> Variable Importance</a></li>
<li class="chapter" data-level="21.5" data-path="random-forests.html"><a href="random-forests.html#adaptiveness-of-random-forest-kernel"><i class="fa fa-check"></i><b>21.5</b> Adaptiveness of Random Forest Kernel</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="adaboost.html"><a href="adaboost.html"><i class="fa fa-check"></i><b>22</b> AdaBoost</a>
<ul>
<li class="chapter" data-level="22.1" data-path="adaboost.html"><a href="adaboost.html#the-algorithm"><i class="fa fa-check"></i><b>22.1</b> The Algorithm</a></li>
<li class="chapter" data-level="22.2" data-path="adaboost.html"><a href="adaboost.html#training-error-bound"><i class="fa fa-check"></i><b>22.2</b> Training Error Bound</a></li>
<li class="chapter" data-level="22.3" data-path="adaboost.html"><a href="adaboost.html#the-stagewise-additive-model-and-probability-calibration"><i class="fa fa-check"></i><b>22.3</b> The Stagewise Additive Model and Probability Calibration</a></li>
<li class="chapter" data-level="22.4" data-path="adaboost.html"><a href="adaboost.html#tuning-the-number-of-trees"><i class="fa fa-check"></i><b>22.4</b> Tuning the Number of Trees</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="gradient-boosting-machines.html"><a href="gradient-boosting-machines.html"><i class="fa fa-check"></i><b>23</b> Gradient Boosting Machines</a>
<ul>
<li class="chapter" data-level="23.1" data-path="gradient-boosting-machines.html"><a href="gradient-boosting-machines.html#motivation-lasso-as-boosting"><i class="fa fa-check"></i><b>23.1</b> Motivation: Lasso as Boosting</a></li>
<li class="chapter" data-level="23.2" data-path="gradient-boosting-machines.html"><a href="gradient-boosting-machines.html#gradient-boosting"><i class="fa fa-check"></i><b>23.2</b> Gradient Boosting</a></li>
<li class="chapter" data-level="23.3" data-path="gradient-boosting-machines.html"><a href="gradient-boosting-machines.html#gradient-boosting-with-general-loss"><i class="fa fa-check"></i><b>23.3</b> Gradient Boosting with General Loss</a></li>
<li class="chapter" data-level="23.4" data-path="gradient-boosting-machines.html"><a href="gradient-boosting-machines.html#logistic-link"><i class="fa fa-check"></i><b>23.4</b> Logistic Link</a></li>
<li class="chapter" data-level="23.5" data-path="gradient-boosting-machines.html"><a href="gradient-boosting-machines.html#xgboost"><i class="fa fa-check"></i><b>23.5</b> xgboost</a></li>
</ul></li>
<li class="part"><span><b>VII Unsupervised Learning</b></span></li>
<li class="chapter" data-level="24" data-path="k-means.html"><a href="k-means.html"><i class="fa fa-check"></i><b>24</b> K-Means</a>
<ul>
<li class="chapter" data-level="24.1" data-path="k-means.html"><a href="k-means.html#basic-concepts"><i class="fa fa-check"></i><b>24.1</b> Basic Concepts</a></li>
<li class="chapter" data-level="24.2" data-path="k-means.html"><a href="k-means.html#example-1-iris-data"><i class="fa fa-check"></i><b>24.2</b> Example 1: <code>iris</code> data</a></li>
<li class="chapter" data-level="24.3" data-path="k-means.html"><a href="k-means.html#example-2-clustering-of-image-pixels"><i class="fa fa-check"></i><b>24.3</b> Example 2: clustering of image pixels</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html"><i class="fa fa-check"></i><b>25</b> Hierarchical Clustering</a>
<ul>
<li class="chapter" data-level="25.1" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#basic-concepts-1"><i class="fa fa-check"></i><b>25.1</b> Basic Concepts</a></li>
<li class="chapter" data-level="25.2" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#example-1-iris-data-1"><i class="fa fa-check"></i><b>25.2</b> Example 1: <code>iris</code> data</a></li>
<li class="chapter" data-level="25.3" data-path="hierarchical-clustering.html"><a href="hierarchical-clustering.html#example-2-rna-expression-data"><i class="fa fa-check"></i><b>25.3</b> Example 2: RNA Expression Data</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html"><i class="fa fa-check"></i><b>26</b> Principal Component Analysis</a>
<ul>
<li class="chapter" data-level="26.1" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#basic-concepts-2"><i class="fa fa-check"></i><b>26.1</b> Basic Concepts</a>
<ul>
<li class="chapter" data-level="26.1.1" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#note-scaling"><i class="fa fa-check"></i><b>26.1.1</b> Note: Scaling</a></li>
</ul></li>
<li class="chapter" data-level="26.2" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#example-1-iris-data-2"><i class="fa fa-check"></i><b>26.2</b> Example 1: <code>iris</code> Data</a></li>
<li class="chapter" data-level="26.3" data-path="principal-component-analysis.html"><a href="principal-component-analysis.html#example-2-handwritten-digits"><i class="fa fa-check"></i><b>26.3</b> Example 2: Handwritten Digits</a></li>
</ul></li>
<li class="chapter" data-level="27" data-path="self-organizing-map.html"><a href="self-organizing-map.html"><i class="fa fa-check"></i><b>27</b> Self-Organizing Map</a>
<ul>
<li class="chapter" data-level="27.1" data-path="self-organizing-map.html"><a href="self-organizing-map.html#basic-concepts-3"><i class="fa fa-check"></i><b>27.1</b> Basic Concepts</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="spectral-clustering.html"><a href="spectral-clustering.html"><i class="fa fa-check"></i><b>28</b> Spectral Clustering</a>
<ul>
<li class="chapter" data-level="28.1" data-path="spectral-clustering.html"><a href="spectral-clustering.html#an-example"><i class="fa fa-check"></i><b>28.1</b> An Example</a></li>
<li class="chapter" data-level="28.2" data-path="spectral-clustering.html"><a href="spectral-clustering.html#adjacency-matrix"><i class="fa fa-check"></i><b>28.2</b> Adjacency Matrix</a></li>
<li class="chapter" data-level="28.3" data-path="spectral-clustering.html"><a href="spectral-clustering.html#laplacian-matrix"><i class="fa fa-check"></i><b>28.3</b> Laplacian Matrix</a></li>
<li class="chapter" data-level="28.4" data-path="spectral-clustering.html"><a href="spectral-clustering.html#derivation-of-the-feature-embedding"><i class="fa fa-check"></i><b>28.4</b> Derivation of the Feature Embedding</a></li>
<li class="chapter" data-level="28.5" data-path="spectral-clustering.html"><a href="spectral-clustering.html#feature-embedding"><i class="fa fa-check"></i><b>28.5</b> Feature Embedding</a></li>
<li class="chapter" data-level="28.6" data-path="spectral-clustering.html"><a href="spectral-clustering.html#clustering-with-embedded-features"><i class="fa fa-check"></i><b>28.6</b> Clustering with Embedded Features</a></li>
<li class="chapter" data-level="28.7" data-path="spectral-clustering.html"><a href="spectral-clustering.html#normalized-graph-laplacian"><i class="fa fa-check"></i><b>28.7</b> Normalized Graph Laplacian</a></li>
<li class="chapter" data-level="28.8" data-path="spectral-clustering.html"><a href="spectral-clustering.html#using-a-different-adjacency-matrix"><i class="fa fa-check"></i><b>28.8</b> Using a Different Adjacency Matrix</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="uniform-manifold-approximation-and-projection.html"><a href="uniform-manifold-approximation-and-projection.html"><i class="fa fa-check"></i><b>29</b> Uniform Manifold Approximation and Projection</a>
<ul>
<li class="chapter" data-level="29.1" data-path="uniform-manifold-approximation-and-projection.html"><a href="uniform-manifold-approximation-and-projection.html#an-example-1"><i class="fa fa-check"></i><b>29.1</b> An Example</a></li>
<li class="chapter" data-level="29.2" data-path="uniform-manifold-approximation-and-projection.html"><a href="uniform-manifold-approximation-and-projection.html#tuning"><i class="fa fa-check"></i><b>29.2</b> Tuning</a></li>
<li class="chapter" data-level="29.3" data-path="uniform-manifold-approximation-and-projection.html"><a href="uniform-manifold-approximation-and-projection.html#another-example"><i class="fa fa-check"></i><b>29.3</b> Another Example</a></li>
</ul></li>
<li class="part"><span><b>VIII Reference</b></span></li>
<li class="chapter" data-level="30" data-path="reference.html"><a href="reference.html"><i class="fa fa-check"></i><b>30</b> Reference</a></li>
<li class="divider"></li>
<li><a href="https://github.com/teazrq/SMLR" target="blank">&copy; 2023 Ruoqing Zhu</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistical Machine Learning with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spline" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Chapter 9</span> Spline<a href="spline.html#spline" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="using-linear-models-for-nonlinear-trends" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Using Linear models for Nonlinear Trends<a href="spline.html#using-linear-models-for-nonlinear-trends" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In previous chapters, we mainly focused linear models. Modeling nonlinear trends can still be done with linear model by introducing higher-order terms, or nonlinear transformations. For example, <span class="math inline">\(x^2\)</span>, <span class="math inline">\(\log(x)\)</span> are all very commonly used approaches to model nonlinear effects. There is another class of approaches that is more flexible with nice theoretical properties, the splines. In this chapter, we mainly focus on univariate regression problems.</p>
</div>
<div id="a-motivating-example-and-polynomials" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> A Motivating Example and Polynomials<a href="spline.html#a-motivating-example-and-polynomials" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We use the U.S. birth rate data as an example. The data records birth rates from 1917 to 2003. The birth rate trend is obviously very nonlinear.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="spline.html#cb91-1" tabindex="-1"></a>    birthrates<span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;data/birthrate2.csv&quot;</span>, <span class="at">row.names =</span> <span class="dv">1</span>)</span>
<span id="cb91-2"><a href="spline.html#cb91-2" tabindex="-1"></a>    <span class="fu">head</span>(birthrates)</span>
<span id="cb91-3"><a href="spline.html#cb91-3" tabindex="-1"></a><span class="do">##   Year Birthrate</span></span>
<span id="cb91-4"><a href="spline.html#cb91-4" tabindex="-1"></a><span class="do">## 1 1917     183.1</span></span>
<span id="cb91-5"><a href="spline.html#cb91-5" tabindex="-1"></a><span class="do">## 2 1918     183.9</span></span>
<span id="cb91-6"><a href="spline.html#cb91-6" tabindex="-1"></a><span class="do">## 3 1919     163.1</span></span>
<span id="cb91-7"><a href="spline.html#cb91-7" tabindex="-1"></a><span class="do">## 4 1920     179.5</span></span>
<span id="cb91-8"><a href="spline.html#cb91-8" tabindex="-1"></a><span class="do">## 5 1921     181.4</span></span>
<span id="cb91-9"><a href="spline.html#cb91-9" tabindex="-1"></a><span class="do">## 6 1922     173.4</span></span>
<span id="cb91-10"><a href="spline.html#cb91-10" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb91-11"><a href="spline.html#cb91-11" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-123-1.png" width="45%" style="display: block; margin: auto;" /></p>
<p>It might be interesting to fit a linear regression with high order polynomials to approximate this curve. This can be carried out using the <code>poly()</code> function, which calculates all polynomials up to a certain power. Please note that this is a more stable method compared with writing out the powers such as <code>I(Year^2)</code>, <code>I(Year^3)</code> etc because the <code>Year</code> variable is very large, and is numerically unstable.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="spline.html#cb92-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb92-2"><a href="spline.html#cb92-2" tabindex="-1"></a></span>
<span id="cb92-3"><a href="spline.html#cb92-3" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb92-4"><a href="spline.html#cb92-4" tabindex="-1"></a>    lmfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Birthrate <span class="sc">~</span> <span class="fu">poly</span>(Year, <span class="dv">3</span>), <span class="at">data =</span> birthrates)</span>
<span id="cb92-5"><a href="spline.html#cb92-5" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb92-6"><a href="spline.html#cb92-6" tabindex="-1"></a>    <span class="fu">lines</span>(birthrates<span class="sc">$</span>Year, lmfit<span class="sc">$</span>fitted.values, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb92-7"><a href="spline.html#cb92-7" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;degree = 3&quot;</span>)</span>
<span id="cb92-8"><a href="spline.html#cb92-8" tabindex="-1"></a>    </span>
<span id="cb92-9"><a href="spline.html#cb92-9" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb92-10"><a href="spline.html#cb92-10" tabindex="-1"></a>    lmfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Birthrate <span class="sc">~</span> <span class="fu">poly</span>(Year, <span class="dv">5</span>), <span class="at">data =</span> birthrates)</span>
<span id="cb92-11"><a href="spline.html#cb92-11" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb92-12"><a href="spline.html#cb92-12" tabindex="-1"></a>    <span class="fu">lines</span>(birthrates<span class="sc">$</span>Year, lmfit<span class="sc">$</span>fitted.values, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb92-13"><a href="spline.html#cb92-13" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;degree = 5&quot;</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-124-1.png" width="80%" style="display: block; margin: auto;" /></p>
<p>These fittings do not seem to perform very well. How about we take a different approach to model the curve locally. Well, we know there is an approach that works in a similar way – <span class="math inline">\(k\)</span>NN. But we will try something new. Let’s first divide the year range into several non-overlapping intervals, say, every 10 years. Then we will estimate the regression coefficients within each interval by averaging the observations, just like <span class="math inline">\(k\)</span>NN. The only difference is that for prediction, we do not recalculate the neighbors anymore, just check the intervals.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="spline.html#cb93-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb93-2"><a href="spline.html#cb93-2" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb93-3"><a href="spline.html#cb93-3" tabindex="-1"></a></span>
<span id="cb93-4"><a href="spline.html#cb93-4" tabindex="-1"></a>    mybasis <span class="ot">=</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(birthrates), <span class="dv">8</span>)</span>
<span id="cb93-5"><a href="spline.html#cb93-5" tabindex="-1"></a>    <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb93-6"><a href="spline.html#cb93-6" tabindex="-1"></a>        mybasis[, l] <span class="ot">=</span> birthrates<span class="sc">$</span>Year<span class="sc">*</span>(birthrates<span class="sc">$</span>Year <span class="sc">&gt;=</span> <span class="dv">1917</span> <span class="sc">+</span> l<span class="sc">*</span><span class="dv">10</span>)</span>
<span id="cb93-7"><a href="spline.html#cb93-7" tabindex="-1"></a>        </span>
<span id="cb93-8"><a href="spline.html#cb93-8" tabindex="-1"></a>    lmfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(birthrates<span class="sc">$</span>Birthrate <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">data.frame</span>(mybasis))</span>
<span id="cb93-9"><a href="spline.html#cb93-9" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb93-10"><a href="spline.html#cb93-10" tabindex="-1"></a>    <span class="fu">lines</span>(birthrates<span class="sc">$</span>Year, lmfit<span class="sc">$</span>fitted.values, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">&quot;s&quot;</span>, <span class="at">col =</span> <span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb93-11"><a href="spline.html#cb93-11" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;Histgram Regression&quot;</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-125-1.png" width="45%" style="display: block; margin: auto;" /></p>
<p>The method is called a histogram regression. Suppose the interval that contains a given testing point <span class="math inline">\(x\)</span> is <span class="math inline">\(\phi(x)\)</span>, then, we are fitting a model with</p>
<p><span class="math display">\[
\widehat{f}(x) = \frac{\sum_{i=1}^n Y_i \,\, I\{X_i \in \phi(x)\} }{ \sum_{i=1}^n I\{X_i \in \phi(x)\}}
\]</span></p>
<p>You may know the word histogram from the plotting the density of a set of observations. Yes, these two are actually motivated by the same philosophy. We will discuss the connection later on. For the purpose of fitting a regression function, the histogram regression does not seem to perform ideally since there will be jumps at the edge of an interval. Hence we need a more flexible framework.</p>
</div>
<div id="piecewise-polynomials" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Piecewise Polynomials<a href="spline.html#piecewise-polynomials" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Instead of fitting constant functions within each interval (between two knots), we may consider fitting a line. Consider a simpler case, where we just use 3 knots at 1938, 1960, 1978, which gives 4 intervals.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="spline.html#cb94-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb94-2"><a href="spline.html#cb94-2" tabindex="-1"></a></span>
<span id="cb94-3"><a href="spline.html#cb94-3" tabindex="-1"></a>    myknots <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1936</span>, <span class="dv">1960</span>, <span class="dv">1978</span>)</span>
<span id="cb94-4"><a href="spline.html#cb94-4" tabindex="-1"></a>    bounds <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1917</span>, myknots, <span class="dv">2003</span>)  </span>
<span id="cb94-5"><a href="spline.html#cb94-5" tabindex="-1"></a>    </span>
<span id="cb94-6"><a href="spline.html#cb94-6" tabindex="-1"></a>    <span class="co"># piecewise constant</span></span>
<span id="cb94-7"><a href="spline.html#cb94-7" tabindex="-1"></a>    mybasis <span class="ot">=</span> <span class="fu">cbind</span>(<span class="st">&quot;x_1&quot;</span> <span class="ot">=</span> (birthrates<span class="sc">$</span>Year <span class="sc">&lt;</span> myknots[<span class="dv">1</span>]), </span>
<span id="cb94-8"><a href="spline.html#cb94-8" tabindex="-1"></a>                    <span class="st">&quot;x_2&quot;</span> <span class="ot">=</span> (birthrates<span class="sc">$</span>Year <span class="sc">&gt;=</span> myknots[<span class="dv">1</span>])<span class="sc">*</span>(birthrates<span class="sc">$</span>Year <span class="sc">&lt;</span> myknots[<span class="dv">2</span>]), </span>
<span id="cb94-9"><a href="spline.html#cb94-9" tabindex="-1"></a>                    <span class="st">&quot;x_3&quot;</span> <span class="ot">=</span> (birthrates<span class="sc">$</span>Year <span class="sc">&gt;=</span> myknots[<span class="dv">2</span>])<span class="sc">*</span>(birthrates<span class="sc">$</span>Year <span class="sc">&lt;</span> myknots[<span class="dv">3</span>]),</span>
<span id="cb94-10"><a href="spline.html#cb94-10" tabindex="-1"></a>                    <span class="st">&quot;x_4&quot;</span> <span class="ot">=</span> (birthrates<span class="sc">$</span>Year <span class="sc">&gt;=</span> myknots[<span class="dv">3</span>]))</span>
<span id="cb94-11"><a href="spline.html#cb94-11" tabindex="-1"></a>        </span>
<span id="cb94-12"><a href="spline.html#cb94-12" tabindex="-1"></a>    lmfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(birthrates<span class="sc">$</span>Birthrate <span class="sc">~</span> . <span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> <span class="fu">data.frame</span>(mybasis))</span>
<span id="cb94-13"><a href="spline.html#cb94-13" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">0</span>))    </span>
<span id="cb94-14"><a href="spline.html#cb94-14" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb94-15"><a href="spline.html#cb94-15" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v =</span> myknots, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb94-16"><a href="spline.html#cb94-16" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;Piecewise constant&quot;</span>)</span>
<span id="cb94-17"><a href="spline.html#cb94-17" tabindex="-1"></a>    </span>
<span id="cb94-18"><a href="spline.html#cb94-18" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb94-19"><a href="spline.html#cb94-19" tabindex="-1"></a>        <span class="fu">points</span>(<span class="fu">c</span>(bounds[k], bounds[k<span class="sc">+</span><span class="dv">1</span>]), <span class="fu">rep</span>(lmfit<span class="sc">$</span>coefficients[k], <span class="dv">2</span>), <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, </span>
<span id="cb94-20"><a href="spline.html#cb94-20" tabindex="-1"></a>               <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb94-21"><a href="spline.html#cb94-21" tabindex="-1"></a>    </span>
<span id="cb94-22"><a href="spline.html#cb94-22" tabindex="-1"></a>    <span class="co"># piecewise linear</span></span>
<span id="cb94-23"><a href="spline.html#cb94-23" tabindex="-1"></a>    mybasis <span class="ot">=</span> <span class="fu">cbind</span>(<span class="st">&quot;x_1&quot;</span> <span class="ot">=</span> (birthrates<span class="sc">$</span>Year <span class="sc">&lt;</span> myknots[<span class="dv">1</span>]), </span>
<span id="cb94-24"><a href="spline.html#cb94-24" tabindex="-1"></a>                    <span class="st">&quot;x_2&quot;</span> <span class="ot">=</span> (birthrates<span class="sc">$</span>Year <span class="sc">&gt;=</span> myknots[<span class="dv">1</span>])<span class="sc">*</span>(birthrates<span class="sc">$</span>Year <span class="sc">&lt;</span> myknots[<span class="dv">2</span>]), </span>
<span id="cb94-25"><a href="spline.html#cb94-25" tabindex="-1"></a>                    <span class="st">&quot;x_3&quot;</span> <span class="ot">=</span> (birthrates<span class="sc">$</span>Year <span class="sc">&gt;=</span> myknots[<span class="dv">2</span>])<span class="sc">*</span>(birthrates<span class="sc">$</span>Year <span class="sc">&lt;</span> myknots[<span class="dv">3</span>]),</span>
<span id="cb94-26"><a href="spline.html#cb94-26" tabindex="-1"></a>                    <span class="st">&quot;x_4&quot;</span> <span class="ot">=</span> (birthrates<span class="sc">$</span>Year <span class="sc">&gt;=</span> myknots[<span class="dv">3</span>]),</span>
<span id="cb94-27"><a href="spline.html#cb94-27" tabindex="-1"></a>                    <span class="st">&quot;x_11&quot;</span> <span class="ot">=</span> birthrates<span class="sc">$</span>Year<span class="sc">*</span>(birthrates<span class="sc">$</span>Year <span class="sc">&lt;</span> myknots[<span class="dv">1</span>]), </span>
<span id="cb94-28"><a href="spline.html#cb94-28" tabindex="-1"></a>                    <span class="st">&quot;x_21&quot;</span> <span class="ot">=</span> birthrates<span class="sc">$</span>Year<span class="sc">*</span>(birthrates<span class="sc">$</span>Year <span class="sc">&gt;=</span> myknots[<span class="dv">1</span>])<span class="sc">*</span>(birthrates<span class="sc">$</span>Year <span class="sc">&lt;</span> myknots[<span class="dv">2</span>]), </span>
<span id="cb94-29"><a href="spline.html#cb94-29" tabindex="-1"></a>                    <span class="st">&quot;x_31&quot;</span> <span class="ot">=</span> birthrates<span class="sc">$</span>Year<span class="sc">*</span>(birthrates<span class="sc">$</span>Year <span class="sc">&gt;=</span> myknots[<span class="dv">2</span>])<span class="sc">*</span>(birthrates<span class="sc">$</span>Year <span class="sc">&lt;</span> myknots[<span class="dv">3</span>]),</span>
<span id="cb94-30"><a href="spline.html#cb94-30" tabindex="-1"></a>                    <span class="st">&quot;x_41&quot;</span> <span class="ot">=</span> birthrates<span class="sc">$</span>Year<span class="sc">*</span>(birthrates<span class="sc">$</span>Year <span class="sc">&gt;=</span> myknots[<span class="dv">3</span>]))</span>
<span id="cb94-31"><a href="spline.html#cb94-31" tabindex="-1"></a>        </span>
<span id="cb94-32"><a href="spline.html#cb94-32" tabindex="-1"></a>    lmfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(birthrates<span class="sc">$</span>Birthrate <span class="sc">~</span> .<span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> <span class="fu">data.frame</span>(mybasis))</span>
<span id="cb94-33"><a href="spline.html#cb94-33" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">0</span>))  </span>
<span id="cb94-34"><a href="spline.html#cb94-34" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb94-35"><a href="spline.html#cb94-35" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v =</span> myknots, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb94-36"><a href="spline.html#cb94-36" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;Piecewise linear&quot;</span>)</span>
<span id="cb94-37"><a href="spline.html#cb94-37" tabindex="-1"></a>    </span>
<span id="cb94-38"><a href="spline.html#cb94-38" tabindex="-1"></a>    <span class="cf">for</span> (k <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>)</span>
<span id="cb94-39"><a href="spline.html#cb94-39" tabindex="-1"></a>        <span class="fu">points</span>(<span class="fu">c</span>(bounds[k], bounds[k<span class="sc">+</span><span class="dv">1</span>]), </span>
<span id="cb94-40"><a href="spline.html#cb94-40" tabindex="-1"></a>               lmfit<span class="sc">$</span>coefficients[k] <span class="sc">+</span> <span class="fu">c</span>(bounds[k], bounds[k<span class="sc">+</span><span class="dv">1</span>])<span class="sc">*</span>lmfit<span class="sc">$</span>coefficients[k<span class="sc">+</span><span class="dv">4</span>], </span>
<span id="cb94-41"><a href="spline.html#cb94-41" tabindex="-1"></a>               <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">4</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-126-1.png" width="80%" style="display: block; margin: auto;" /></p>
</div>
<div id="splines" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Splines<a href="spline.html#splines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>However, these functions are not continuous. Hence we use a trick to construct continuous basis:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="spline.html#cb95-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb95-2"><a href="spline.html#cb95-2" tabindex="-1"></a>    pos <span class="ot">&lt;-</span> <span class="cf">function</span>(x) x<span class="sc">*</span>(x<span class="sc">&gt;</span><span class="dv">0</span>)</span>
<span id="cb95-3"><a href="spline.html#cb95-3" tabindex="-1"></a>    mybasis <span class="ot">=</span> <span class="fu">cbind</span>(<span class="st">&quot;int&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;x_1&quot;</span> <span class="ot">=</span> birthrates<span class="sc">$</span>Year, </span>
<span id="cb95-4"><a href="spline.html#cb95-4" tabindex="-1"></a>                    <span class="st">&quot;x_2&quot;</span> <span class="ot">=</span> <span class="fu">pos</span>(birthrates<span class="sc">$</span>Year <span class="sc">-</span> myknots[<span class="dv">1</span>]), </span>
<span id="cb95-5"><a href="spline.html#cb95-5" tabindex="-1"></a>                    <span class="st">&quot;x_3&quot;</span> <span class="ot">=</span> <span class="fu">pos</span>(birthrates<span class="sc">$</span>Year <span class="sc">-</span> myknots[<span class="dv">2</span>]),</span>
<span id="cb95-6"><a href="spline.html#cb95-6" tabindex="-1"></a>                    <span class="st">&quot;x_4&quot;</span> <span class="ot">=</span> <span class="fu">pos</span>(birthrates<span class="sc">$</span>Year <span class="sc">-</span> myknots[<span class="dv">3</span>]))</span>
<span id="cb95-7"><a href="spline.html#cb95-7" tabindex="-1"></a>    </span>
<span id="cb95-8"><a href="spline.html#cb95-8" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb95-9"><a href="spline.html#cb95-9" tabindex="-1"></a>    <span class="fu">matplot</span>(birthrates<span class="sc">$</span>Year, mybasis[, <span class="sc">-</span><span class="dv">1</span>], <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span>, </span>
<span id="cb95-10"><a href="spline.html#cb95-10" tabindex="-1"></a>            <span class="at">yaxt =</span> <span class="st">&#39;n&#39;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>), <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb95-11"><a href="spline.html#cb95-11" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;Spline Basis Functions&quot;</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-127-1.png" width="45%" style="display: block; margin: auto;" /></p>
<p>With this definition, any fitted model will be</p>
<ul>
<li>Continuous everywhere</li>
<li>Linear everywhere except the knots</li>
<li>Has a different slot for each region</li>
</ul>
<p>The resulted model is called a spline.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="spline.html#cb96-1" tabindex="-1"></a>    lmfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(birthrates<span class="sc">$</span>Birthrate <span class="sc">~</span> .<span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> <span class="fu">data.frame</span>(mybasis))</span>
<span id="cb96-2"><a href="spline.html#cb96-2" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">0</span>))  </span>
<span id="cb96-3"><a href="spline.html#cb96-3" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb96-4"><a href="spline.html#cb96-4" tabindex="-1"></a>    <span class="fu">lines</span>(birthrates<span class="sc">$</span>Year, lmfit<span class="sc">$</span>fitted.values, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb96-5"><a href="spline.html#cb96-5" tabindex="-1"></a>    <span class="fu">abline</span>(<span class="at">v =</span> myknots, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb96-6"><a href="spline.html#cb96-6" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;Linear Spline&quot;</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-128-1.png" width="45%" style="display: block; margin: auto;" /></p>
<p>Of course, writing this out explicitly is very tedious, hence we have the <code>bs</code> function in the <code>splines</code> package to help us.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="spline.html#cb97-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb97-2"><a href="spline.html#cb97-2" tabindex="-1"></a>    lmfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Birthrate <span class="sc">~</span> splines<span class="sc">::</span><span class="fu">bs</span>(Year, <span class="at">degree =</span> <span class="dv">1</span>, <span class="at">knots =</span> myknots), <span class="at">data =</span> birthrates)</span>
<span id="cb97-3"><a href="spline.html#cb97-3" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb97-4"><a href="spline.html#cb97-4" tabindex="-1"></a>    <span class="fu">lines</span>(birthrates<span class="sc">$</span>Year, lmfit<span class="sc">$</span>fitted.values, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb97-5"><a href="spline.html#cb97-5" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;Linear spline with the bs() function&quot;</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-129-1.png" width="45%" style="display: block; margin: auto;" /></p>
<p>The next step is to increase the degree to account for more complicated functions. A few things we need to consider here:</p>
<ul>
<li>How many knots should be used</li>
<li>Where to place the knots</li>
<li>What is the degree of functions in each region</li>
</ul>
<p>For example, we consider this setting</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="spline.html#cb98-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb98-2"><a href="spline.html#cb98-2" tabindex="-1"></a>    lmfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Birthrate <span class="sc">~</span> splines<span class="sc">::</span><span class="fu">bs</span>(Year, <span class="at">degree =</span> <span class="dv">3</span>, <span class="at">knots =</span> myknots), <span class="at">data =</span> birthrates)</span>
<span id="cb98-3"><a href="spline.html#cb98-3" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb98-4"><a href="spline.html#cb98-4" tabindex="-1"></a>    <span class="fu">lines</span>(birthrates<span class="sc">$</span>Year, lmfit<span class="sc">$</span>fitted.values, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb98-5"><a href="spline.html#cb98-5" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;Cubic spline with 3 knots&quot;</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-130-1.png" width="45%" style="display: block; margin: auto;" /></p>
<p>All of them affects the performance. In particular, the number of knots and the number of degrees in each region will determine the total number of degrees of freedom. For simplicity, we can control that using the <code>df</code> parameter. We use a total of 6 parameters, chosen by the function automatically. However, this does not seems to perform better than the knots we implemented. The choice of knots can be crucial.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="spline.html#cb99-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>))</span>
<span id="cb99-2"><a href="spline.html#cb99-2" tabindex="-1"></a>    lmfit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Birthrate <span class="sc">~</span> splines<span class="sc">::</span><span class="fu">bs</span>(Year, <span class="at">df =</span> <span class="dv">5</span>), <span class="at">data =</span> birthrates)</span>
<span id="cb99-3"><a href="spline.html#cb99-3" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb99-4"><a href="spline.html#cb99-4" tabindex="-1"></a>    <span class="fu">lines</span>(birthrates<span class="sc">$</span>Year, lmfit<span class="sc">$</span>fitted.values, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">col =</span> <span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lwd =</span> <span class="dv">4</span>)</span>
<span id="cb99-5"><a href="spline.html#cb99-5" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;Linear spline with 6 degrees of parameters&quot;</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-131-1.png" width="45%" style="display: block; margin: auto;" /></p>
</div>
<div id="spline-basis" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> Spline Basis<a href="spline.html#spline-basis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are different ways to construct spline basis. We used two techniques previously, the regression spline and basis spline (B-spline). The B-spline has slight more advantages computationally. Here is a comparision of B-spline with different degrees.</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="spline.html#cb100-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">1</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb100-2"><a href="spline.html#cb100-2" tabindex="-1"></a></span>
<span id="cb100-3"><a href="spline.html#cb100-3" tabindex="-1"></a>    <span class="cf">for</span> (d <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">3</span>)</span>
<span id="cb100-4"><a href="spline.html#cb100-4" tabindex="-1"></a>    {</span>
<span id="cb100-5"><a href="spline.html#cb100-5" tabindex="-1"></a>        bs_d <span class="ot">=</span> splines2<span class="sc">::</span><span class="fu">bSpline</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">degree =</span> d, <span class="at">knots =</span> <span class="fu">seq</span>(<span class="dv">10</span>, <span class="dv">90</span>, <span class="dv">10</span>), <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb100-6"><a href="spline.html#cb100-6" tabindex="-1"></a>        <span class="fu">matplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, bs_d, <span class="at">type =</span> <span class="fu">ifelse</span>(d <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&quot;s&quot;</span>, <span class="st">&quot;l&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">ylab =</span> <span class="st">&quot;spline&quot;</span>, </span>
<span id="cb100-7"><a href="spline.html#cb100-7" tabindex="-1"></a>                <span class="at">xaxt =</span> <span class="st">&#39;n&#39;</span>, <span class="at">yaxt =</span> <span class="st">&#39;n&#39;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.05</span>, <span class="fl">1.05</span>), <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb100-8"><a href="spline.html#cb100-8" tabindex="-1"></a>        <span class="fu">title</span>(<span class="fu">paste</span>(<span class="st">&quot;degree =&quot;</span>, d))</span>
<span id="cb100-9"><a href="spline.html#cb100-9" tabindex="-1"></a>    }</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-132-1.png" width="45%" style="display: block; margin: auto;" /></p>
</div>
<div id="natural-cubic-spline" class="section level2 hasAnchor" number="9.6">
<h2><span class="header-section-number">9.6</span> Natural Cubic Spline<a href="spline.html#natural-cubic-spline" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Extrapolations are generally dangerous because the functions could be extream outside the range of the observed data. In linear models fit by <code>bs()</code>, extrapolations outside the boundaries will trigger a warning.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="spline.html#cb101-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb101-2"><a href="spline.html#cb101-2" tabindex="-1"></a>    <span class="fu">library</span>(splines)</span>
<span id="cb101-3"><a href="spline.html#cb101-3" tabindex="-1"></a>    fit.bs <span class="ot">=</span> <span class="fu">lm</span>(Birthrate <span class="sc">~</span> <span class="fu">bs</span>(Year, <span class="at">df=</span><span class="dv">6</span>), <span class="at">data=</span>birthrates)</span>
<span id="cb101-4"><a href="spline.html#cb101-4" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates<span class="sc">$</span>Year, birthrates<span class="sc">$</span>Birthrate, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">280</span>), <span class="at">pch =</span> <span class="dv">19</span>, </span>
<span id="cb101-5"><a href="spline.html#cb101-5" tabindex="-1"></a>         <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1900</span>, <span class="dv">2020</span>), <span class="at">xlab =</span> <span class="st">&quot;year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;rate&quot;</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)   </span>
<span id="cb101-6"><a href="spline.html#cb101-6" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="fu">seq</span>(<span class="dv">1900</span>, <span class="dv">2020</span>), <span class="fu">predict</span>(fit.bs, <span class="fu">data.frame</span>(<span class="st">&quot;Year&quot;</span><span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1900</span>, <span class="dv">2020</span>))),</span>
<span id="cb101-7"><a href="spline.html#cb101-7" tabindex="-1"></a>          <span class="at">col=</span><span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">3</span>)    </span>
<span id="cb101-8"><a href="spline.html#cb101-8" tabindex="-1"></a><span class="do">## Warning in bs(Year, degree = 3L, knots = c(1938.5, 1960, 1981.5), Boundary.knots = c(1917L, : some</span></span>
<span id="cb101-9"><a href="spline.html#cb101-9" tabindex="-1"></a><span class="do">## &#39;x&#39; values beyond boundary knots may cause ill-conditioned bases</span></span>
<span id="cb101-10"><a href="spline.html#cb101-10" tabindex="-1"></a>    </span>
<span id="cb101-11"><a href="spline.html#cb101-11" tabindex="-1"></a>    fit.ns <span class="ot">=</span> <span class="fu">lm</span>(Birthrate <span class="sc">~</span> <span class="fu">ns</span>(Year, <span class="at">df=</span><span class="dv">6</span>), <span class="at">data=</span>birthrates)    </span>
<span id="cb101-12"><a href="spline.html#cb101-12" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="fu">seq</span>(<span class="dv">1900</span>, <span class="dv">2020</span>), <span class="fu">predict</span>(fit.ns, <span class="fu">data.frame</span>(<span class="st">&quot;Year&quot;</span><span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">1900</span>, <span class="dv">2020</span>))), </span>
<span id="cb101-13"><a href="spline.html#cb101-13" tabindex="-1"></a>          <span class="at">col=</span><span class="st">&quot;darkgreen&quot;</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb101-14"><a href="spline.html#cb101-14" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;Cubic B-Spline&quot;</span>, <span class="st">&quot;Natural Cubic Spline&quot;</span>), </span>
<span id="cb101-15"><a href="spline.html#cb101-15" tabindex="-1"></a>           <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;deepskyblue&quot;</span>, <span class="st">&quot;darkgreen&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span>
<span id="cb101-16"><a href="spline.html#cb101-16" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;Birth rate extrapolation&quot;</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-133-1.png" width="45%" style="display: block; margin: auto;" /></p>
<p>Hence this motivates us to consider setting additional constrains that forces the extrapolations to be come more regular. This is done by forcing the second and third derivatives to be 0 if beyond the two extreme knots.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="spline.html#cb102-1" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb102-2"><a href="spline.html#cb102-2" tabindex="-1"></a>    ncs <span class="ot">=</span> <span class="fu">ns</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="at">df =</span> <span class="dv">6</span>, <span class="at">intercept =</span> <span class="cn">TRUE</span>)</span>
<span id="cb102-3"><a href="spline.html#cb102-3" tabindex="-1"></a>    <span class="fu">matplot</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, ncs, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>, <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">ylab =</span> <span class="st">&quot;spline&quot;</span>,</span>
<span id="cb102-4"><a href="spline.html#cb102-4" tabindex="-1"></a>            <span class="at">xaxt =</span> <span class="st">&#39;n&#39;</span>, <span class="at">yaxt =</span> <span class="st">&#39;n&#39;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb102-5"><a href="spline.html#cb102-5" tabindex="-1"></a>    <span class="fu">title</span>(<span class="st">&quot;Natural Cubic Spline&quot;</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-134-1.png" width="45%" style="display: block; margin: auto;" /></p>
</div>
<div id="smoothing-spline" class="section level2 hasAnchor" number="9.7">
<h2><span class="header-section-number">9.7</span> Smoothing Spline<a href="spline.html#smoothing-spline" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The motivation is to trying to solve the knots selection issue. Instead, let’s start with a “horrible” idea, by putting knots at all each observed data point <span class="math inline">\((x_1, x_2, \ldots, x_n)\)</span>. Then, we can create <span class="math inline">\(n\)</span> natural cubic spline basis. However, we also know that this leads to over-fitting since there are too many parameters. Let’s utilize the ridge regression idea by adding some penalties. This leads to the objective function</p>
<p><span class="math display" id="eq:penalized">\[\begin{equation}
\underset{\boldsymbol{\beta}}{\text{min}} \,\, \lVert \mathbf{y}- \mathbf{F}\boldsymbol{\beta}\rVert^2 + \lambda \boldsymbol{\beta}^\text{T}\Omega \boldsymbol{\beta}, \tag{9.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\mathbf{F}\)</span> is the matrix of all <span class="math inline">\(n\)</span> natural cubic spline basis, and <span class="math inline">\(\Omega\)</span> is some covariance matrix that takes care of some form of relationship among different basis, which we will define later, and <span class="math inline">\(\lambda\)</span> is similar to the ridge regression. The question is, will this type of regression problem provide a good solution with nice properties?</p>
<p>Let’s consider fitting a regression model by solving a regression function <span class="math inline">\(g(x)\)</span> with the following penalized criteria:</p>
<p><span class="math display" id="eq:roughness">\[\begin{equation}
\frac{1}{n} \sum_{i=1}^n \big(y_i - g(x_i)\big)^2 + \lambda \int_a^b \big[g&#39;&#39;(x) \big]^2 dx. \tag{9.2}
\end{equation}\]</span></p>
<p>This is the sum of <span class="math inline">\(\ell_2\)</span> loss and a roughness penalty that enforce certain smoothness on <span class="math inline">\(g(x)\)</span>. And we shall show that the optimal <span class="math inline">\(g(x)\)</span> that minimize this objective function will take the ridge penalty form in <a href="spline.html#eq:penalized">(9.1)</a> mentioned previously.</p>
<p>We will consider all absolutely continuous functions on <span class="math inline">\([a, b] = [\min(x_i), \max(x_i)]\)</span>, with finite roughness, i.e., <span class="math inline">\(\int_a^b \big[g&#39;&#39;(x) \big]^2 dx &lt; \infty\)</span>. This is known as the second order Sobolev space. Let’s first define <span class="math inline">\(g(\cdot)\)</span> as the optimal solution to Equation <a href="spline.html#eq:roughness">(9.2)</a>. Since the loss part in <a href="spline.html#eq:roughness">(9.2)</a> only involves <span class="math inline">\(n\)</span> data points, we can find define a natural cubic spline (NCS) fit <span class="math inline">\(\tilde{g}(\cdot)\)</span> such that it matches with <span class="math inline">\(g(\cdot)\)</span> on all the observed data, i.e.,</p>
<p><span class="math display">\[g(x_i) = \widetilde{g}(x_i), \quad i = 1, \ldots, n.\]</span></p>
<p>Note that the roughness of NCS fit <span class="math inline">\(\widetilde{g}\)</span> is also finite, hence <span class="math inline">\(\widetilde{g}\)</span> is within the space of functions we are considering. Also, such matching on all observed data points is doable when we have <span class="math inline">\(n\)</span> basis in the natural cubic spline. In this case, the loss corresponds to <span class="math inline">\(\tilde{g}\)</span> and <span class="math inline">\(g\)</span> are identical. Hence, it only matters if the penalty part of <span class="math inline">\(\tilde{g}(\cdot)\)</span> is the same. To analyze this, we define the difference between these two functions as</p>
<p><span class="math display">\[h(x) = g(x) - \tilde{g}(x).\]</span>
It is then obvious that <span class="math inline">\(h(x_i) = 0\)</span> for all observed <span class="math inline">\(i\)</span>. Then we have</p>
<p><span class="math display">\[\int g&#39;&#39;^2 dx = \int \widetilde{g}&#39;&#39;^2 dx + \int h&#39;&#39;^2 dx + 2 \int \widetilde{g}&#39;&#39; h&#39;&#39; dx\]</span>
The first and second term on the right hand side are both non-negative. Hence, only the third term matters. WLOG, we assume that <span class="math inline">\(x_i\)</span>’s are ordered from the smallest to the largest. Then</p>
<p><span class="math display">\[\begin{align}
\int \tilde{g}&#39;&#39; h&#39;&#39; dx =&amp; ~\tilde{g}&#39;&#39; h&#39; \Big|_a^b - \int_a^b h&#39; \tilde{g}^{(3)} dx \nonumber \\
=&amp;~ 0 - \int_a^b h&#39; \tilde{g}^{(3)} dx \nonumber \\
=&amp;~ - \sum_{i=1}^{n-1} \tilde{g}^{(3)}(x_j^+) \int_{x_j}^{x_{j+1}} h&#39; dx \quad \nonumber \\
=&amp;~ - \sum_{i=1}^{n-1} \tilde{g}^{(3)}(x_j^+) \big(h(x_{j+1}) - h(x_j)\big) \nonumber \\
=&amp;~ 0
\end{align}\]</span></p>
<p>The second equation is because <span class="math inline">\(\tilde{g}\)</span> is a NCS and suppose to have 0 second derivative on the two boundaries <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>. The third equation is because <span class="math inline">\(\tilde{g}\)</span> is at most <span class="math inline">\(x^3\)</span> on any regions and have constant third derivatives, which we can pull out of the integration. And the last equation is because <span class="math inline">\(h(x) = 0\)</span> on all <span class="math inline">\(x_i\)</span>’s.</p>
<p>Hence, this shows that the roughness penalty <span class="math display">\[\int \widetilde{g}&#39;&#39;^2 dx\]</span> of our NCS solution is no larger than the best solution <span class="math inline">\(g\)</span>. Noticing that <span class="math inline">\(\widetilde{g}\)</span> is also with the space of functions we are considering, then <span class="math inline">\(g\)</span> must be our NCS solution.</p>
<p>Hence, <span class="math inline">\(g\)</span> has a finite sample representation</p>
<p><span class="math display">\[\widehat g(x) = \sum_{j=1}^n \beta_j N_j(x)\]</span></p>
<p>where <span class="math inline">\(N_j\)</span>’s are a set of natural cubic spline basis functions with knots at each of the unique <span class="math inline">\(x\)</span> values. Then Equation <a href="spline.html#eq:roughness">(9.2)</a> becomes</p>
<p><span class="math display">\[\begin{align}
&amp; \lVert \mathbf{y}- \sum_{j=1}^n \beta_j N_j(x) \rVert^2 + \int \Big( \sum_{j=1}^n \beta_j N_j&#39;&#39;(x)\Big)^2 dx \\
=&amp; \lVert \mathbf{y}- \mathbf{F}\boldsymbol{\beta}\rVert^2 + \boldsymbol{\beta}^\text{T}\Omega \boldsymbol{\beta},
\end{align}\]</span></p>
<p>where <span class="math inline">\(\mathbf{F}\)</span> is the design matrix corresponds to the <span class="math inline">\(n\)</span> NCS basis <span class="math inline">\(N_j\)</span>’s, and <span class="math inline">\(\Omega\)</span> is an <span class="math inline">\(n \times n\)</span> matrix with <span class="math inline">\(\Omega_{ij} = \int N_i&#39;&#39;(x) N_j(x) dx.\)</span> The solution is essentially a ridge solution:</p>
<p><span class="math display">\[\widehat{\boldsymbol{\beta}} = (\mathbf{F}^\text{T}\mathbf{F}+ \lambda \Omega)^{-1} \mathbf{F}^\text{T}\mathbf{y}.\]</span>
and the penalty <span class="math inline">\(\lambda\)</span> can be tuned using GCV.</p>
</div>
<div id="fitting-smoothing-splines" class="section level2 hasAnchor" number="9.8">
<h2><span class="header-section-number">9.8</span> Fitting Smoothing Splines<a href="spline.html#fitting-smoothing-splines" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Fitting a smoothing spline can be done by using the <code>smooth.spline</code> package. However, since the birthrate data has little variation in adjacent years, over-fitting is quite severe. The function will automatically use GCV to tune the parameter.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="spline.html#cb103-1" tabindex="-1"></a>    <span class="co"># smoothing spline </span></span>
<span id="cb103-2"><a href="spline.html#cb103-2" tabindex="-1"></a>    fit <span class="ot">=</span> <span class="fu">smooth.spline</span>(birthrates<span class="sc">$</span>Year, birthrates<span class="sc">$</span>Birthrate)</span>
<span id="cb103-3"><a href="spline.html#cb103-3" tabindex="-1"></a>    <span class="fu">plot</span>(birthrates<span class="sc">$</span>Year, birthrates<span class="sc">$</span>Birthrate, <span class="at">pch =</span> <span class="dv">19</span>, </span>
<span id="cb103-4"><a href="spline.html#cb103-4" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;BirthRates&quot;</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb103-5"><a href="spline.html#cb103-5" tabindex="-1"></a>    <span class="fu">lines</span>(<span class="fu">seq</span>(<span class="dv">1917</span>, <span class="dv">2003</span>), <span class="fu">predict</span>(fit, <span class="fu">seq</span>(<span class="dv">1917</span>, <span class="dv">2003</span>))<span class="sc">$</span>y, <span class="at">col=</span><span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-135-1.png" width="45%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="spline.html#cb104-1" tabindex="-1"></a>    </span>
<span id="cb104-2"><a href="spline.html#cb104-2" tabindex="-1"></a>    <span class="co"># the degrees of freedom is very large</span></span>
<span id="cb104-3"><a href="spline.html#cb104-3" tabindex="-1"></a>    fit<span class="sc">$</span>df</span>
<span id="cb104-4"><a href="spline.html#cb104-4" tabindex="-1"></a><span class="do">## [1] 60.7691</span></span></code></pre></div>
<p>Let’s look at another simulation example, where this method performs reasonably well.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="spline.html#cb105-1" tabindex="-1"></a>    <span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb105-2"><a href="spline.html#cb105-2" tabindex="-1"></a>    n <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb105-3"><a href="spline.html#cb105-3" tabindex="-1"></a>    x <span class="ot">=</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> n)</span>
<span id="cb105-4"><a href="spline.html#cb105-4" tabindex="-1"></a>    y <span class="ot">=</span> <span class="fu">sin</span>(<span class="dv">12</span><span class="sc">*</span>(x<span class="fl">+0.2</span>))<span class="sc">/</span>(x<span class="fl">+0.2</span>) <span class="sc">+</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb105-5"><a href="spline.html#cb105-5" tabindex="-1"></a>    </span>
<span id="cb105-6"><a href="spline.html#cb105-6" tabindex="-1"></a>    <span class="co"># fit smoothing spline</span></span>
<span id="cb105-7"><a href="spline.html#cb105-7" tabindex="-1"></a>    fit <span class="ot">=</span> <span class="fu">smooth.spline</span>(x, y)</span>
<span id="cb105-8"><a href="spline.html#cb105-8" tabindex="-1"></a>    </span>
<span id="cb105-9"><a href="spline.html#cb105-9" tabindex="-1"></a>    <span class="co"># the degrees of freedom</span></span>
<span id="cb105-10"><a href="spline.html#cb105-10" tabindex="-1"></a>    fit<span class="sc">$</span>df    </span>
<span id="cb105-11"><a href="spline.html#cb105-11" tabindex="-1"></a><span class="do">## [1] 9.96443</span></span>
<span id="cb105-12"><a href="spline.html#cb105-12" tabindex="-1"></a>    </span>
<span id="cb105-13"><a href="spline.html#cb105-13" tabindex="-1"></a>    <span class="co"># fitted model</span></span>
<span id="cb105-14"><a href="spline.html#cb105-14" tabindex="-1"></a>    <span class="fu">plot</span>(x, y, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">xlab =</span> <span class="st">&quot;x&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;y&quot;</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span>
<span id="cb105-15"><a href="spline.html#cb105-15" tabindex="-1"></a>    <span class="fu">lines</span>(x, <span class="fu">sin</span>(<span class="dv">12</span><span class="sc">*</span>(x<span class="fl">+0.2</span>))<span class="sc">/</span>(x<span class="fl">+0.2</span>), <span class="at">col=</span><span class="st">&quot;red&quot;</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">3</span>)    </span>
<span id="cb105-16"><a href="spline.html#cb105-16" tabindex="-1"></a>    <span class="fu">lines</span>(x, <span class="fu">predict</span>(fit, x)<span class="sc">$</span>y, <span class="at">col=</span><span class="st">&quot;deepskyblue&quot;</span>, <span class="at">lty=</span><span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb105-17"><a href="spline.html#cb105-17" tabindex="-1"></a>    <span class="fu">legend</span>(<span class="st">&quot;bottomright&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;Truth&quot;</span>, <span class="st">&quot;Smoothing Splines&quot;</span>), </span>
<span id="cb105-18"><a href="spline.html#cb105-18" tabindex="-1"></a>           <span class="at">col =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;deepskyblue&quot;</span>), <span class="at">lty =</span> <span class="dv">1</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-136-1.png" width="45%" style="display: block; margin: auto;" /></p>
</div>
<div id="extending-splines-to-multiple-varibles" class="section level2 hasAnchor" number="9.9">
<h2><span class="header-section-number">9.9</span> Extending Splines to Multiple Varibles<a href="spline.html#extending-splines-to-multiple-varibles" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Since all spline approaches can be transformed into some kind of linear model, if we postulate an additive structure, we can fit a multivariate model with</p>
<p><span class="math display">\[f(x) = \sum_j h_j(x_j) = \sum_j \sum_k N_{jk}(x_j) \beta_{jk}\]</span>
where <span class="math inline">\(h_j(x_j)\)</span> is a univariate function for <span class="math inline">\(x_j\)</span> that can be approximated by splines basis <span class="math inline">\(N_{jk}(\cdot), k = 1, \ldots, K\)</span>. This works for both linear regression and generalized linear regressions. For the South Africa Heart Disease data, we use the <code>gam()</code> function in the <code>gam</code> (generalized additive models) package. We compute a logistic regression model using natural splines (note <code>famhist</code> is included as a factor).</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="spline.html#cb106-1" tabindex="-1"></a>    <span class="fu">library</span>(ElemStatLearn)</span>
<span id="cb106-2"><a href="spline.html#cb106-2" tabindex="-1"></a>    <span class="fu">library</span>(gam)</span>
<span id="cb106-3"><a href="spline.html#cb106-3" tabindex="-1"></a><span class="do">## Loading required package: foreach</span></span>
<span id="cb106-4"><a href="spline.html#cb106-4" tabindex="-1"></a><span class="do">## Loaded gam 1.22-5</span></span>
<span id="cb106-5"><a href="spline.html#cb106-5" tabindex="-1"></a></span>
<span id="cb106-6"><a href="spline.html#cb106-6" tabindex="-1"></a>    form <span class="ot">=</span> <span class="fu">formula</span>(<span class="st">&quot;chd ~ ns(sbp,df=4) + ns(tobacco,df=4) + </span></span>
<span id="cb106-7"><a href="spline.html#cb106-7" tabindex="-1"></a><span class="st">                          ns(ldl,df=4) + famhist + ns(obesity,df=4) + </span></span>
<span id="cb106-8"><a href="spline.html#cb106-8" tabindex="-1"></a><span class="st">                          ns(alcohol,df=4) + ns(age,df=4)&quot;</span>)</span>
<span id="cb106-9"><a href="spline.html#cb106-9" tabindex="-1"></a>    </span>
<span id="cb106-10"><a href="spline.html#cb106-10" tabindex="-1"></a>    <span class="co"># note that we can also do </span></span>
<span id="cb106-11"><a href="spline.html#cb106-11" tabindex="-1"></a>    <span class="co"># m = glm(form, data=SAheart, family=binomial)</span></span>
<span id="cb106-12"><a href="spline.html#cb106-12" tabindex="-1"></a>    <span class="co"># print(summary(m), digits=3)</span></span>
<span id="cb106-13"><a href="spline.html#cb106-13" tabindex="-1"></a>    <span class="co"># however, the gam function provides more information </span></span>
<span id="cb106-14"><a href="spline.html#cb106-14" tabindex="-1"></a>    </span>
<span id="cb106-15"><a href="spline.html#cb106-15" tabindex="-1"></a>    m <span class="ot">=</span> <span class="fu">gam</span>(form, <span class="at">data=</span>SAheart, <span class="at">family=</span>binomial)</span>
<span id="cb106-16"><a href="spline.html#cb106-16" tabindex="-1"></a>    <span class="fu">summary</span>(m)</span>
<span id="cb106-17"><a href="spline.html#cb106-17" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb106-18"><a href="spline.html#cb106-18" tabindex="-1"></a><span class="do">## Call: gam(formula = form, family = binomial, data = SAheart)</span></span>
<span id="cb106-19"><a href="spline.html#cb106-19" tabindex="-1"></a><span class="do">## Deviance Residuals:</span></span>
<span id="cb106-20"><a href="spline.html#cb106-20" tabindex="-1"></a><span class="do">##     Min      1Q  Median      3Q     Max </span></span>
<span id="cb106-21"><a href="spline.html#cb106-21" tabindex="-1"></a><span class="do">## -1.7245 -0.8265 -0.3884  0.8870  2.9589 </span></span>
<span id="cb106-22"><a href="spline.html#cb106-22" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb106-23"><a href="spline.html#cb106-23" tabindex="-1"></a><span class="do">## (Dispersion Parameter for binomial family taken to be 1)</span></span>
<span id="cb106-24"><a href="spline.html#cb106-24" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb106-25"><a href="spline.html#cb106-25" tabindex="-1"></a><span class="do">##     Null Deviance: 596.1084 on 461 degrees of freedom</span></span>
<span id="cb106-26"><a href="spline.html#cb106-26" tabindex="-1"></a><span class="do">## Residual Deviance: 457.6318 on 436 degrees of freedom</span></span>
<span id="cb106-27"><a href="spline.html#cb106-27" tabindex="-1"></a><span class="do">## AIC: 509.6318 </span></span>
<span id="cb106-28"><a href="spline.html#cb106-28" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb106-29"><a href="spline.html#cb106-29" tabindex="-1"></a><span class="do">## Number of Local Scoring Iterations: 6 </span></span>
<span id="cb106-30"><a href="spline.html#cb106-30" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb106-31"><a href="spline.html#cb106-31" tabindex="-1"></a><span class="do">## Anova for Parametric Effects</span></span>
<span id="cb106-32"><a href="spline.html#cb106-32" tabindex="-1"></a><span class="do">##                      Df Sum Sq Mean Sq F value    Pr(&gt;F)    </span></span>
<span id="cb106-33"><a href="spline.html#cb106-33" tabindex="-1"></a><span class="do">## ns(sbp, df = 4)       4   6.31  1.5783  1.4242  0.224956    </span></span>
<span id="cb106-34"><a href="spline.html#cb106-34" tabindex="-1"></a><span class="do">## ns(tobacco, df = 4)   4  18.09  4.5218  4.0802  0.002941 ** </span></span>
<span id="cb106-35"><a href="spline.html#cb106-35" tabindex="-1"></a><span class="do">## ns(ldl, df = 4)       4  12.05  3.0137  2.7194  0.029290 *  </span></span>
<span id="cb106-36"><a href="spline.html#cb106-36" tabindex="-1"></a><span class="do">## famhist               1  19.70 19.7029 17.7788 3.019e-05 ***</span></span>
<span id="cb106-37"><a href="spline.html#cb106-37" tabindex="-1"></a><span class="do">## ns(obesity, df = 4)   4   3.66  0.9161  0.8266  0.508701    </span></span>
<span id="cb106-38"><a href="spline.html#cb106-38" tabindex="-1"></a><span class="do">## ns(alcohol, df = 4)   4   1.28  0.3200  0.2887  0.885278    </span></span>
<span id="cb106-39"><a href="spline.html#cb106-39" tabindex="-1"></a><span class="do">## ns(age, df = 4)       4  17.64  4.4100  3.9794  0.003496 ** </span></span>
<span id="cb106-40"><a href="spline.html#cb106-40" tabindex="-1"></a><span class="do">## Residuals           436 483.19  1.1082                      </span></span>
<span id="cb106-41"><a href="spline.html#cb106-41" tabindex="-1"></a><span class="do">## ---</span></span>
<span id="cb106-42"><a href="spline.html#cb106-42" tabindex="-1"></a><span class="do">## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</span></span>
<span id="cb106-43"><a href="spline.html#cb106-43" tabindex="-1"></a>    </span>
<span id="cb106-44"><a href="spline.html#cb106-44" tabindex="-1"></a>    <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">0</span>))</span>
<span id="cb106-45"><a href="spline.html#cb106-45" tabindex="-1"></a>    <span class="fu">plot</span>(m, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">residuals =</span> <span class="cn">TRUE</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">col =</span> <span class="st">&quot;darkorange&quot;</span>)</span></code></pre></div>
<p><img src="SMLR_files/figure-html/unnamed-chunk-137-1.png" width="90%" style="display: block; margin: auto;" /></p>

<div style="display:none;">
<!-- Conflict \def\bf{\mathbf{f}} -->
</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="lasso.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="logistic-regression.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "sepia",
    "family": "serif",
    "size": 1
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
